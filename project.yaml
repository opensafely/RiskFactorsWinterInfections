version: '3.0'

expectations:

  population_size: 200000

actions:

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
  ## DO NOT EDIT project.yaml DIRECTLY 
  ## This file is created by create_project_actions.R 
  ## Edit and run create_project_actions.R to update the project.yaml 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
  ## Generate study definitions 

  generate_study_population_winter2019:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_winter2019
      --output-format csv.gz
    outputs:
      highly_sensitive:
        cohort: output/input_winter2019.csv.gz

  generate_study_population_winter2021:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_winter2021
      --output-format csv.gz
    outputs:
      highly_sensitive:
        cohort: output/input_winter2021.csv.gz

  ## Data cleaning 

  data_cleaning_winter2019:
    run: stata-mp:latest analysis/data_cleaning.do winter2019 td(1dec2019) td(28feb2020)
    needs:
    - generate_study_population_winter2019
    outputs:
      moderately_sensitive:
        describe: output/consort_winter2019.xlsx
      highly_sensitive:
        cohort: output/clean_winter2019.csv.gz

  data_cleaning_winter2021:
    run: stata-mp:latest analysis/data_cleaning/data_cleaning.do winter2021 td(1dec2021)
      td(28feb2022)
    needs:
    - generate_study_population_winter2021
    outputs:
      moderately_sensitive:
        describe: output/consort_winter2021.xlsx
      highly_sensitive:
        cohort: output/clean_winter2021.csv.gz

