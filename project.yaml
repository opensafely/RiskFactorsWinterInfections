version: '3.0'

expectations:

  population_size: 200000

actions:

  ## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
  ## DO NOT EDIT project.yaml DIRECTLY 
  ## This file is created by create_project_actions.R 
  ## Edit and run create_project_actions.R to update the project.yaml 
  ## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
  ## Generate study population - winter2019 

  generate_study_population_winter2019:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_winter2019
      --output-format csv.gz
    outputs:
      highly_sensitive:
        cohort: output/input_winter2019.csv.gz

  ## Describe - input_winter2019.csv.gz 

  describe_input_winter2019:
    run: stata-mp:latest analysis/describe.do input_winter2019 csv
    needs:
    - generate_study_population_winter2019
    outputs:
      highly_sensitive:
        cohort: output/describe-input_winter2019.log

  ## Data cleaning - winter2019 

  data_cleaning_winter2019:
    run: stata-mp:latest analysis/data_cleaning.do winter2019 td(1dec2019) td(28feb2020)
    needs:
    - generate_study_population_winter2019
    outputs:
      moderately_sensitive:
        consort: output/consort_winter2019.csv
        rounded_consort: output/rounded_consort_winter2019.csv
      highly_sensitive:
        cohort: output/clean_winter2019.dta.gz

  ## Describe - clean_winter2019.dta.gz 

  describe_clean_winter2019:
    run: stata-mp:latest analysis/describe.do clean_winter2019 dta
    needs:
    - data_cleaning_winter2019
    outputs:
      highly_sensitive:
        cohort: output/describe-clean_winter2019.log

  ## Table 1 - winter2019 

  table1_winter2019:
    run: stata-mp:latest analysis/table1.do winter2019
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        table1: output/table1_winter2019.csv
        rounded_table1: output/rounded_table1_winter2019.csv

  ## Table 2 - winter2019 

  table2_winter2019:
    run: stata-mp:latest analysis/table2.do winter2019
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        table1: output/table2_winter2019.csv
        rounded_table1: output/rounded_table2_winter2019.csv

  ## Generate study population - winter2021 

  generate_study_population_winter2021:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_winter2021
      --output-format csv.gz
    outputs:
      highly_sensitive:
        cohort: output/input_winter2021.csv.gz

  ## Describe - input_winter2021.csv.gz 

  describe_input_winter2021:
    run: stata-mp:latest analysis/describe.do input_winter2021 csv
    needs:
    - generate_study_population_winter2021
    outputs:
      highly_sensitive:
        cohort: output/describe-input_winter2021.log

  ## Data cleaning - winter2021 

  data_cleaning_winter2021:
    run: stata-mp:latest analysis/data_cleaning.do winter2021 td(1dec2021) td(28feb2022)
    needs:
    - generate_study_population_winter2021
    outputs:
      moderately_sensitive:
        consort: output/consort_winter2021.csv
        rounded_consort: output/rounded_consort_winter2021.csv
      highly_sensitive:
        cohort: output/clean_winter2021.dta.gz

  ## Describe - clean_winter2021.dta.gz 

  describe_clean_winter2021:
    run: stata-mp:latest analysis/describe.do clean_winter2021 dta
    needs:
    - data_cleaning_winter2021
    outputs:
      highly_sensitive:
        cohort: output/describe-clean_winter2021.log

  ## Table 1 - winter2021 

  table1_winter2021:
    run: stata-mp:latest analysis/table1.do winter2021
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        table1: output/table1_winter2021.csv
        rounded_table1: output/rounded_table1_winter2021.csv

  ## Table 2 - winter2021 

  table2_winter2021:
    run: stata-mp:latest analysis/table2.do winter2021
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        table1: output/table2_winter2021.csv
        rounded_table1: output/rounded_table2_winter2021.csv

  ## cox model - flu_adm - winter2019 

  cox_model_flu_adm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 flu_adm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-flu_adm-winter2019.csv
        rounded_results: output/cox_model-flu_adm-winter2019_rounded.csv

  ## cox model - flu_adm - winter2021 

  cox_model_flu_adm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 flu_adm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-flu_adm-winter2021.csv
        rounded_results: output/cox_model-flu_adm-winter2021_rounded.csv

  ## cox model - rsv_adm - winter2019 

  cox_model_rsv_adm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 rsv_adm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-rsv_adm-winter2019.csv
        rounded_results: output/cox_model-rsv_adm-winter2019_rounded.csv

  ## cox model - rsv_adm - winter2021 

  cox_model_rsv_adm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 rsv_adm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-rsv_adm-winter2021.csv
        rounded_results: output/cox_model-rsv_adm-winter2021_rounded.csv

  ## cox model - pneustrep_adm - winter2019 

  cox_model_pneustrep_adm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 pneustrep_adm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneustrep_adm-winter2019.csv
        rounded_results: output/cox_model-pneustrep_adm-winter2019_rounded.csv

  ## cox model - pneustrep_adm - winter2021 

  cox_model_pneustrep_adm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 pneustrep_adm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneustrep_adm-winter2021.csv
        rounded_results: output/cox_model-pneustrep_adm-winter2021_rounded.csv

  ## cox model - pneu_adm - winter2019 

  cox_model_pneu_adm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 pneu_adm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneu_adm-winter2019.csv
        rounded_results: output/cox_model-pneu_adm-winter2019_rounded.csv

  ## cox model - pneu_adm - winter2021 

  cox_model_pneu_adm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 pneu_adm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneu_adm-winter2021.csv
        rounded_results: output/cox_model-pneu_adm-winter2021_rounded.csv

  ## cox model - covid_adm - winter2021 

  cox_model_covid_adm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 covid_adm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-covid_adm-winter2021.csv
        rounded_results: output/cox_model-covid_adm-winter2021_rounded.csv

  ## cox model - flu_readm - winter2019 

  cox_model_flu_readm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 flu_readm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-flu_readm-winter2019.csv
        rounded_results: output/cox_model-flu_readm-winter2019_rounded.csv

  ## cox model - flu_readm - winter2021 

  cox_model_flu_readm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 flu_readm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-flu_readm-winter2021.csv
        rounded_results: output/cox_model-flu_readm-winter2021_rounded.csv

  ## cox model - rsv_readm - winter2019 

  cox_model_rsv_readm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 rsv_readm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-rsv_readm-winter2019.csv
        rounded_results: output/cox_model-rsv_readm-winter2019_rounded.csv

  ## cox model - rsv_readm - winter2021 

  cox_model_rsv_readm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 rsv_readm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-rsv_readm-winter2021.csv
        rounded_results: output/cox_model-rsv_readm-winter2021_rounded.csv

  ## cox model - pneustrep_readm - winter2019 

  cox_model_pneustrep_readm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 pneustrep_readm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneustrep_readm-winter2019.csv
        rounded_results: output/cox_model-pneustrep_readm-winter2019_rounded.csv

  ## cox model - pneustrep_readm - winter2021 

  cox_model_pneustrep_readm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 pneustrep_readm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneustrep_readm-winter2021.csv
        rounded_results: output/cox_model-pneustrep_readm-winter2021_rounded.csv

  ## cox model - pneu_readm - winter2019 

  cox_model_pneu_readm_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 pneu_readm
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneu_readm-winter2019.csv
        rounded_results: output/cox_model-pneu_readm-winter2019_rounded.csv

  ## cox model - pneu_readm - winter2021 

  cox_model_pneu_readm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 pneu_readm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneu_readm-winter2021.csv
        rounded_results: output/cox_model-pneu_readm-winter2021_rounded.csv

  ## cox model - covid_readm - winter2021 

  cox_model_covid_readm_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 covid_readm
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-covid_readm-winter2021.csv
        rounded_results: output/cox_model-covid_readm-winter2021_rounded.csv

  ## cox model - flu_death - winter2019 

  cox_model_flu_death_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 flu_death
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-flu_death-winter2019.csv
        rounded_results: output/cox_model-flu_death-winter2019_rounded.csv

  ## cox model - flu_death - winter2021 

  cox_model_flu_death_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 flu_death
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-flu_death-winter2021.csv
        rounded_results: output/cox_model-flu_death-winter2021_rounded.csv

  ## cox model - rsv_death - winter2019 

  cox_model_rsv_death_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 rsv_death
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-rsv_death-winter2019.csv
        rounded_results: output/cox_model-rsv_death-winter2019_rounded.csv

  ## cox model - rsv_death - winter2021 

  cox_model_rsv_death_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 rsv_death
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-rsv_death-winter2021.csv
        rounded_results: output/cox_model-rsv_death-winter2021_rounded.csv

  ## cox model - pneustrep_death - winter2019 

  cox_model_pneustrep_death_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 pneustrep_death
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneustrep_death-winter2019.csv
        rounded_results: output/cox_model-pneustrep_death-winter2019_rounded.csv

  ## cox model - pneustrep_death - winter2021 

  cox_model_pneustrep_death_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 pneustrep_death
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneustrep_death-winter2021.csv
        rounded_results: output/cox_model-pneustrep_death-winter2021_rounded.csv

  ## cox model - pneu_death - winter2019 

  cox_model_pneu_death_winter2019:
    run: stata-mp:latest analysis/cox_model.do winter2019 pneu_death
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneu_death-winter2019.csv
        rounded_results: output/cox_model-pneu_death-winter2019_rounded.csv

  ## cox model - pneu_death - winter2021 

  cox_model_pneu_death_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 pneu_death
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-pneu_death-winter2021.csv
        rounded_results: output/cox_model-pneu_death-winter2021_rounded.csv

  ## cox model - covid_death - winter2021 

  cox_model_covid_death_winter2021:
    run: stata-mp:latest analysis/cox_model.do winter2021 covid_death
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/cox_model-covid_death-winter2021.csv
        rounded_results: output/cox_model-covid_death-winter2021_rounded.csv

  ## linear model - flu_stay - winter2019 

  linear_model_flu_stay_winter2019:
    run: stata-mp:latest analysis/linear_model.do winter2019 flu_stay
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/linear_model-flu_stay-winter2019.csv
        rounded_results: output/linear_model-flu_stay-winter2019_rounded.csv

  ## linear model - flu_stay - winter2021 

  linear_model_flu_stay_winter2021:
    run: stata-mp:latest analysis/linear_model.do winter2021 flu_stay
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/linear_model-flu_stay-winter2021.csv
        rounded_results: output/linear_model-flu_stay-winter2021_rounded.csv

  ## linear model - rsv_stay - winter2019 

  linear_model_rsv_stay_winter2019:
    run: stata-mp:latest analysis/linear_model.do winter2019 rsv_stay
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/linear_model-rsv_stay-winter2019.csv
        rounded_results: output/linear_model-rsv_stay-winter2019_rounded.csv

  ## linear model - rsv_stay - winter2021 

  linear_model_rsv_stay_winter2021:
    run: stata-mp:latest analysis/linear_model.do winter2021 rsv_stay
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/linear_model-rsv_stay-winter2021.csv
        rounded_results: output/linear_model-rsv_stay-winter2021_rounded.csv

  ## linear model - pneustrep_stay - winter2019 

  linear_model_pneustrep_stay_winter2019:
    run: stata-mp:latest analysis/linear_model.do winter2019 pneustrep_stay
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/linear_model-pneustrep_stay-winter2019.csv
        rounded_results: output/linear_model-pneustrep_stay-winter2019_rounded.csv

  ## linear model - pneustrep_stay - winter2021 

  linear_model_pneustrep_stay_winter2021:
    run: stata-mp:latest analysis/linear_model.do winter2021 pneustrep_stay
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/linear_model-pneustrep_stay-winter2021.csv
        rounded_results: output/linear_model-pneustrep_stay-winter2021_rounded.csv

  ## linear model - pneu_stay - winter2019 

  linear_model_pneu_stay_winter2019:
    run: stata-mp:latest analysis/linear_model.do winter2019 pneu_stay
    needs:
    - data_cleaning_winter2019
    outputs:
      moderately_sensitive:
        results: output/linear_model-pneu_stay-winter2019.csv
        rounded_results: output/linear_model-pneu_stay-winter2019_rounded.csv

  ## linear model - pneu_stay - winter2021 

  linear_model_pneu_stay_winter2021:
    run: stata-mp:latest analysis/linear_model.do winter2021 pneu_stay
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/linear_model-pneu_stay-winter2021.csv
        rounded_results: output/linear_model-pneu_stay-winter2021_rounded.csv

  ## linear model - covid_stay - winter2021 

  linear_model_covid_stay_winter2021:
    run: stata-mp:latest analysis/linear_model.do winter2021 covid_stay
    needs:
    - data_cleaning_winter2021
    outputs:
      moderately_sensitive:
        results: output/linear_model-covid_stay-winter2021.csv
        rounded_results: output/linear_model-covid_stay-winter2021_rounded.csv

  ## Combine results 

  combine_results:
    run: stata-mp:latest analysis/combine_results.do
    needs:
    - cox_model_flu_adm_winter2019
    - cox_model_flu_adm_winter2021
    - cox_model_rsv_adm_winter2019
    - cox_model_rsv_adm_winter2021
    - cox_model_pneustrep_adm_winter2019
    - cox_model_pneustrep_adm_winter2021
    - cox_model_pneu_adm_winter2019
    - cox_model_pneu_adm_winter2021
    - cox_model_covid_adm_winter2021
    - cox_model_flu_readm_winter2019
    - cox_model_flu_readm_winter2021
    - cox_model_rsv_readm_winter2019
    - cox_model_rsv_readm_winter2021
    - cox_model_pneustrep_readm_winter2019
    - cox_model_pneustrep_readm_winter2021
    - cox_model_pneu_readm_winter2019
    - cox_model_pneu_readm_winter2021
    - cox_model_covid_readm_winter2021
    - cox_model_flu_death_winter2019
    - cox_model_flu_death_winter2021
    - cox_model_rsv_death_winter2019
    - cox_model_rsv_death_winter2021
    - cox_model_pneustrep_death_winter2019
    - cox_model_pneustrep_death_winter2021
    - cox_model_pneu_death_winter2019
    - cox_model_pneu_death_winter2021
    - cox_model_covid_death_winter2021
    - linear_model_flu_stay_winter2019
    - linear_model_flu_stay_winter2021
    - linear_model_rsv_stay_winter2019
    - linear_model_rsv_stay_winter2021
    - linear_model_pneustrep_stay_winter2019
    - linear_model_pneustrep_stay_winter2021
    - linear_model_pneu_stay_winter2019
    - linear_model_pneu_stay_winter2021
    - linear_model_covid_stay_winter2021
    outputs:
      moderately_sensitive:
        rounded_results: output/results_rounded.csv

